<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SnR Signal Pro â€” TradingView (No API)</title>
  <link rel="preconnect" href="https://s3.tradingview.com">
  <style>
    :root{
      --bg:#0b1221; --panel:#0f172a; --card:#121a2b; --line:#1f2a44;
      --text:#e6edf6; --muted:#93a4c3; --accent:#22c55e; --accent2:#38bdf8;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Arial}
    header{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg,#0b1221 0%,#0b1221cc 100%);
      border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1300px;margin:0 auto;padding:16px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;background:#22c55e22;display:grid;place-items:center}
    h1{font-size:20px;margin:0;color:var(--accent2)}
    .muted{color:var(--muted)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-left:auto}
    select,button{
      background:var(--panel);color:var(--text);
      border:1px solid var(--line);border-radius:10px;padding:10px 12px;font-size:14px
    }
    main{padding:18px}
    .grid{display:grid;gap:16px}
    @media(min-width:1000px){.grid{grid-template-columns:1.35fr .65fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .kpi{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .stat{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:10px}
    .badge{border:1px solid var(--line);background:var(--panel);border-radius:999px;padding:6px 10px;font-size:12px}
    #tvbox{border-radius:12px;overflow:hidden}
    .hint{font-size:13px;line-height:1.65;color:var(--muted)}
    .title{font-weight:700}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div class="brand">
        <div class="logo">ðŸ“Š</div>
        <div>
          <h1>SnR Signal Pro</h1>
          <div class="muted" style="font-size:12px">Support-Resistance â€¢ EMA â€¢ RSI â€¢ MACD â€¢ Pivot Points</div>
        </div>
      </div>
      <div class="controls">
        <select id="pair">
          <option value="OANDA:XAUUSD" selected>XAUUSD (Gold)</option>
          <option value="FX:EURUSD">EURUSD</option>
          <option value="FX:GBPUSD">GBPUSD</option>
          <option value="FX:USDJPY">USDJPY</option>
          <option value="BINANCE:BTCUSDT">BTCUSD (Binance)</option>
          <option value="BINANCE:ETHUSDT">ETHUSD (Binance)</option>
        </select>
        <select id="tf">
          <option value="5">M5</option>
          <option value="15">M15</option>
          <option value="60" selected>H1</option>
          <option value="240">H4</option>
          <option value="D">D1</option>
        </select>
        <select id="theme">
          <option value="dark" selected>Dark</option>
          <option value="light">Light</option>
        </select>
        <button id="reload">Refresh</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- LEFT: Advanced chart -->
      <section class="card">
        <div class="row" style="justify-content:space-between;margin-bottom:8px">
          <div class="row">
            <span class="badge" id="pairBadge">OANDA:XAUUSD</span>
            <span class="badge" id="tfBadge">TF: H1</span>
            <span class="badge">Tanpa API Key</span>
          </div>
          <div class="row">
            <label class="muted">Tinggi chart: <span id="hVal">560</span>px</label>
            <input id="hSlider" type="range" min="380" max="1000" value="560" />
            <button id="fullBtn">Fullscreen</button>
          </div>
        </div>

        <!-- TradingView Advanced Chart -->
        <div id="tvbox">
          <div id="tv_chart_container"></div>
        </div>

        <div class="hint" style="margin-top:14px">
          <span class="title">Aturan Entry (visual):</span>
          <ul>
            <li><b>BUY</b> saat EMA7 menembus EMA21 ke atas + harga reject di Support/Pivot, RSI &gt; 50, MACD &gt; 0.</li>
            <li><b>SELL</b> saat EMA7 memotong EMA21 ke bawah + harga reject di Resistance/Pivot, RSI &lt; 50, MACD &lt; 0.</li>
            <li>TP/SL (scalping): gunakan <b>Pivot/Support/Resistance</b> terdekat atau risk:reward 1:2.</li>
          </ul>
        </div>
      </section>

      <!-- RIGHT: Technicals + Screener + Notes -->
      <aside class="grid" style="grid-template-columns:1fr">
        <div class="card">
          <div class="row" style="justify-content:space-between">
            <div class="title">Rekomendasi Teknis (TradingView)</div>
            <span class="muted" style="font-size:12px">Realtime dari TradingView</span>
          </div>
          <div id="tv_ta_container" style="margin-top:10px"></div>
        </div>

        <div class="card">
          <div class="title" style="margin-bottom:10px">Screener Cepat</div>
          <div id="tv_screener_container"></div>
        </div>

        <div class="card">
          <div class="title" style="margin-bottom:6px">Tips Presisi</div>
          <div class="hint">
            Kombinasi <b>SnR + EMA Cross</b> sering dipakai trader intraday. Akurasi sangat bergantung pada
            volatilitas & sesi market. Selalu uji di beberapa timeframe (M15/H1/H4) dan pertimbangkan
            konfirmasi multi-indikator + konfirmasi struktur market.
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- TradingView library is loaded on the fly in create* functions -->

  <script>
    const pairEl = document.getElementById('pair');
    const tfEl = document.getElementById('tf');
    const themeEl = document.getElementById('theme');
    const reloadBtn = document.getElementById('reload');
    const hSlider = document.getElementById('hSlider');
    const hVal = document.getElementById('hVal');
    const fullBtn = document.getElementById('fullBtn');
    const pairBadge = document.getElementById('pairBadge');
    const tfBadge = document.getElementById('tfBadge');

    function tfLabel(v){
      return v==='D'?'D1':(v==='240'?'H4':(v==='60'?'H1':(v==='15'?'M15':'M5')));
    }

    function clearNode(n){ while(n.firstChild) n.removeChild(n.firstChild); }

    function createAdvancedChart(symbol, interval, theme, height){
      clearNode(document.getElementById('tv_chart_container'));
      const s = document.createElement('script');
      s.src = "https://s3.tradingview.com/tv.js";
      s.onload = () => {
        /* eslint-disable no-undef */
        new TradingView.widget({
          autosize: true,
          height: height,
          symbol: symbol,
          interval: interval,
          timezone: "Etc/UTC",
          theme: theme,
          style: "1",
          locale: "en",
          toolbar_bg: "rgba(0,0,0,1)",
          hide_top_toolbar: false,
          hide_legend: false,
          allow_symbol_change: true,
          container_id: "tv_chart_container",
          studies: [
            "MACD@tv-basicstudies",
            "RSI@tv-basicstudies",
            "PivotPointsStandard@tv-basicstudies",
            "Moving Average Exponential@tv-basicstudies",
            "Moving Average Exponential@tv-basicstudies"
          ],
          // hint: untuk set panjang EMA, user tinggal klik gear di panel indikator
          withdateranges: true,
          details: true,
          hotlist: false,
          calendar: false,
          support_host: "https://www.tradingview.com"
        });
      };
      document.body.appendChild(s);
    }

    function createTechAnalysis(symbol, interval, theme){
      clearNode(document.getElementById('tv_ta_container'));
      const w = document.createElement('script');
      w.src = "https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js";
      w.async = true;
      w.innerHTML = JSON.stringify({
        interval: interval, width: "100%", isTransparent: true, height: 400,
        symbol: symbol, showIntervalTabs: true, displayMode: "single",
        colorTheme: theme, locale: "en"
      });
      document.getElementById('tv_ta_container').appendChild(w);
    }

    function createScreener(theme){
      clearNode(document.getElementById('tv_screener_container'));
      const w = document.createElement('script');
      w.src = "https://s3.tradingview.com/external-embedding/embed-widget-screener.js";
      w.async = true;
      w.innerHTML = JSON.stringify({
        width: "100%", height: 420, defaultColumn: "overview",
        defaultScreen: "forex", market: "forex", colorTheme: theme,
        showToolbar: true, locale: "en", isTransparent: true
      });
      document.getElementById('tv_screener_container').appendChild(w);
    }

    function refreshAll(){
      const symbol = pairEl.value;
      const interval = tfEl.value;
      const theme = themeEl.value === 'light' ? 'light' : 'dark';
      const h = parseInt(hSlider.value,10);

      pairBadge.textContent = symbol;
      tfBadge.textContent = 'TF: ' + tfLabel(interval);
      hVal.textContent = h;

      createAdvancedChart(symbol, interval, theme, h);
      createTechAnalysis(symbol, interval, theme);
      createScreener(theme);
    }

    // Events
    reloadBtn.onclick = refreshAll;
    pairEl.onchange = refreshAll;
    tfEl.onchange = refreshAll;
    themeEl.onchange = refreshAll;
    hSlider.oninput = () => { hVal.textContent = hSlider.value; };
    hSlider.onchange = refreshAll;

    fullBtn.onclick = () => {
      const box = document.getElementById('tvbox');
      if (box.requestFullscreen) box.requestFullscreen();
      else if (box.webkitRequestFullscreen) box.webkitRequestFullscreen();
      else if (box.msRequestFullscreen) box.msRequestFullscreen();
    };

    // first render
    refreshAll();
  </script>
</body>
</html>
