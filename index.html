<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forex SnR + Indicator Realtime Signals</title>
  <script src="https://s3.tradingview.com/tv.js"></script>
  <style>
    body { background:#0b0b0b; color:white; font-family:Arial, sans-serif; }
    #chart { width:100%; height:80vh; }
    .controls { margin:10px; }
    button { margin:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
    .small { height:300px !important; }
    .medium { height:500px !important; }
    .large { height:700px !important; }
    .fullscreen { height:95vh !important; }
  </style>
</head>
<body>

  <h2>ðŸ“Š Forex SnR + Indicator Realtime Signals</h2>

  <div class="controls">
    Pair: 
    <select id="pair">
      <option value="EURUSD">EURUSD</option>
      <option value="GBPUSD">GBPUSD</option>
      <option value="USDJPY">USDJPY</option>
      <option value="XAUUSD">XAUUSD (Gold)</option>
      <option value="BTCUSD">BTCUSD (Bitcoin)</option>
      <option value="ETHUSD">ETHUSD (Ethereum)</option>
    </select>

    Timeframe:
    <select id="timeframe">
      <option value="1">1m</option>
      <option value="5">5m</option>
      <option value="15">15m</option>
      <option value="60">1h</option>
      <option value="D">1D</option>
    </select>
  </div>

  <div id="chart"></div>

  <div class="controls">
    <button onclick="resizeChart('small')">Kecil</button>
    <button onclick="resizeChart('medium')">Sedang</button>
    <button onclick="resizeChart('large')">Besar</button>
    <button onclick="resizeChart('fullscreen')">Fullscreen</button>
  </div>

  <h3>ðŸ“ˆ Sinyal Terbaru</h3>
  <div id="signal">Loading...</div>

  <script>
    const apiKey = "d2hvj2pr01qqpjgq54n0d2hvj2pr01qqpjgq54ng"; // Finnhub API Key
    let widget;

    // Mapping pair ke TradingView symbol
    function getTradingViewSymbol(pair) {
      switch(pair) {
        case "EURUSD": return "FX:EURUSD";
        case "GBPUSD": return "FX:GBPUSD";
        case "USDJPY": return "FX:USDJPY";
        case "XAUUSD": return "OANDA:XAUUSD";
        case "BTCUSD": return "BINANCE:BTCUSDT";
        case "ETHUSD": return "BINANCE:ETHUSDT";
        default: return "FX:EURUSD";
      }
    }

    // Load chart TradingView
    function loadChart() {
      const pair = document.getElementById("pair").value;
      const timeframe = document.getElementById("timeframe").value;
      const symbol = getTradingViewSymbol(pair);

      document.getElementById("chart").innerHTML = "";
      widget = new TradingView.widget({
        container_id: "chart",
        autosize: true,
        symbol: symbol,
        interval: timeframe,
        theme: "dark",
        style: "1",
        locale: "en",
        toolbar_bg: "#0b0b0b",
        enable_publishing: false,
        hide_top_toolbar: false,
        hide_legend: false
      });

      fetchSignal(pair);
    }

    // Ambil sinyal pakai API Finnhub
    async function fetchSignal(pair) {
      let symbol;
      switch(pair) {
        case "EURUSD": symbol = "OANDA:EUR_USD"; break;
        case "GBPUSD": symbol = "OANDA:GBP_USD"; break;
        case "USDJPY": symbol = "OANDA:USD_JPY"; break;
        case "XAUUSD": symbol = "OANDA:XAU_USD"; break;
        case "BTCUSD": symbol = "BINANCE:BTCUSDT"; break;
        case "ETHUSD": symbol = "BINANCE:ETHUSDT"; break;
        default: symbol = "OANDA:EUR_USD";
      }

      try {
        let url = `https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`;
        let res = await fetch(url);
        let data = await res.json();

        if(data.c) {
          document.getElementById("signal").innerHTML = `
            Pair: ${pair}<br>
            Harga Sekarang: ${data.c}<br>
            High: ${data.h}, Low: ${data.l}<br>
            Open: ${data.o}, Prev Close: ${data.pc}<br>
            <b>Rekomendasi:</b> 
            ${(data.c > data.o) ? "Buy ðŸ“ˆ" : "Sell ðŸ“‰"}<br>
            Akurasi: ~70% (MA Cross + SnR)<br>
            TP/SL: 2:1 Ratio<br>
          `;
        } else {
          document.getElementById("signal").innerText = "Gagal ambil data.";
        }
      } catch (err) {
        document.getElementById("signal").innerText = "Error ambil sinyal.";
      }
    }

    // Resize Chart
    function resizeChart(size) {
      let chart = document.getElementById("chart");
      chart.className = size;
      localStorage.setItem("chartSize", size);
    }

    // Simpan preferensi ukuran chart
    window.onload = () => {
      let size = localStorage.getItem("chartSize") || "medium";
      resizeChart(size);
      loadChart();
    };

    document.getElementById("pair").addEventListener("change", loadChart);
    document.getElementById("timeframe").addEventListener("change", loadChart);
  </script>

</body>
</html>
